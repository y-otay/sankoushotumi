<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.152.2/build/three.module.js"
      }
    }
  </script>
  <script type="module">

import * as THREE from "three";

const width = 960;
const height = 540;

const renderer = new THREE.WebGLRenderer({
  canvas: document.querySelector("#myCanvas"),
});
renderer.setPixelRatio(window.devicePixelRatio);
renderer.setSize(width, height);

const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(45, width / height);
camera.position.set(0, -150, 1500);

const geometry = new THREE.BoxGeometry(400, 20, 300);
const material = new THREE.MeshNormalMaterial();
const boxes = [];
let floatingBox = null

let moveDirection2 = 6;
let moveDirection3 = 6;
let score = 0;

function moveboxX() {
  floatingBox.position.x += moveDirection2;
  if (floatingBox.position.x >= 450 || floatingBox.position.x <= -450) {
    moveDirection2 = -moveDirection2;
  }
}

function moveboxY(box) {
  floatingBox.position.y -= moveDirection3;
}

function createBox() {
  const box = new THREE.Mesh(geometry, material);
  box.position.set(0, 200, 0);
  scene.add(box);
  floatingBox = box
}

const landedBoxes = [];

let state = "x"
function animate() {
requestAnimationFrame(animate);
if(state=="y"){
  moveboxY();
  if(floatingBox.position.y <= -480+20*landedBoxes.length){
  landedBoxes.push(floatingBox);
  createBox();
  state="x"
  score += 10;  // Update the score
      document.getElementById('score').innerText = 'Score: ' + score;  // Update the score display
    
}
  }else if(state=="x"){
    moveboxX();
  }

  renderer.render(scene, camera);
}

// アニメーションを開始
createBox();
animate();
  document.addEventListener("click",()=>
{
state = "y"; 
}
 )
//スコアを表示
// スコアを表示
document.getElementById('score').innerText = 'Score: ' + score;
</script>
</head>
<body>

  <div id ="score"></div>
  <canvas id="myCanvas"></canvas>
</body>
</html>
